<head>
  <style>
    body {
      background-color: #000;
      margin: 0;
    }
    canvas {
      zoom: 0.5;
    }
  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <script src="https://unpkg.com/nipplejs@0.10.1/dist/nipplejs.js"></script>
  <script src="https://unpkg.com/phaser@3.60.0/dist/phaser.min.js"></script>
  <script src="https://unpkg.com/react@17.0.2/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17.0.2/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/playroomkit/multiplayer.umd.js"></script>
  <script type="module">
    window._USETEMPSTORAGE = true;
    const { onPlayerJoin, insertCoin, isHost, myPlayer, isStreamScreen } = Playroom;

    class Main extends Phaser.Scene {
      controls = {};
      players = []; 

      create() {
        onPlayerJoin(player => this.addPlayer(player));

        if (isStreamScreen()) {
          this.scene.start('StreamScene');
        } else {
          this.scene.start('ControllerScene');
        }
      }

      addPlayer(playerState) {
        const sprite = this.add.rectangle(
          Phaser.Math.Between(100, 500), 200, 100, 100, playerState.getProfile().color.hex);
        this.physics.add.existing(sprite, false);
        sprite.body.setCollideWorldBounds(true);
        this.players.push({
          sprite,
          state: playerState
        });
        playerState.onQuit(() => {
          sprite.destroy();
          this.players = this.players.filter(p => p.state !== playerState);
        });
      }

      update() {
        if (isHost()) {
          // Host-specific update logic
        } else {
          // Controller-specific update logic
        }
      }
    }

    const config = {
      type: Phaser.AUTO,
      width: 600,
      height: 1280,
      parent: 'root',
      physics: {
        default: 'arcade',
        arcade: {
          gravity: { y: 0 }
        }
      },
      scene: [Main]
    };

    insertCoin().then(() => {
      const game = new Phaser.Game(config);
    });
  </script>
</body>